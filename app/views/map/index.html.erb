<%= stylesheet_link_tag 'map', :media => 'all' %> <%# media => "all" は全てのデバイス、"handheld"は携帯電話など、"aural"は音声合成装置など  %>
<%= stylesheet_link_tag 'postForm', :media => 'all' %>
<%= stylesheet_link_tag 'post_image', :media => 'all' %>
<%= stylesheet_link_tag 'postShow', :media => 'all' %>
<%= stylesheet_link_tag 'menuButton', :media => 'all' %>
<%= stylesheet_link_tag 'sidebar', :media => 'all' %>

<% content_for :js do %><%# application内のyieldの:jsのつくところの中身となる。~doは複数行を読み込む %>
  <%= javascript_import_module_tag "map" %>
  <%= javascript_import_module_tag "sidebar" %>
  <%= javascript_import_module_tag  "userSearch" %>
<% end %>


<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBgixBC-unxRTH-NrxJ3eF14qzKMIPGp2c&callback=initMap&v=weekly"></script>
<script>
var add_post_icon = "<%= asset_path('addPostIcon.png') %>";
var postGreenButton = "<%= asset_path('postGreenButton.png') %>";
var login_user_id = "<%= @user_id %>";
var login_user_name = "<%= @user_name %>"
var login_user_icon = "<%= user_icon_url(@user) %>";
var post_triger_icon = "<%= asset_path('forPostTriger.png') %>";

var imagesData = <%= (@images || []).each_with_index.map { |image, index|
  user = User.find(image.user_id)
  icon_url = user_icon_url(user)
  { 
    id: index, 
    url: icon_url,
    latitude: image.latitude,
    longitude: image.longitude,
    user_id: image.user_id,
    user_name: user.name,
    image_id: image.id,
    created_at: image.created_at.strftime('%H:%M')
  }
}.to_json.html_safe %>;

</script>

<div id="popupForm" class="popup-overlay">
  <div class="popup-content">
    <button type="button" id="close-btn" class="close-btn">&#10005;</button> <!-- Cross Mark -->
    <%= form_with(model: @image, url: images_path, local: true, html: { id: "imageForm", method: "post" }) do |form| %><%# modelは利用するモデル名、localはHTTPメソッド(true)かAjaxか、html:はそのidとmethodをブロックに指定する %>
      <div class="image-upload">
      <%= form.file_field :post_image, accept: 'image/*',id: 'post_image', required: true %>
      <label for="post_image" class="image-upload-prompt">
        <div class="upload-icon">&#128247;</div> <!-- Camera Icon -->
        <div>画像をアップロード</div>
        <button type="button" id="cancel-upload">画像取り消し</button>
      </label>
      </div>
      <div class="field comment-section">
        <div class="user-icon-and-label">
          <div class="user-icon">&#128100;</div>
          <%= form.label :comment, 'コメント' %> <br />
        </div>
        <div class="comment-input">
          <%= form.text_field :comment %>
        </div>
      </div>
      <% if user_signed_in? %><%# ユーザーがログインしているならそのidをそうでないなら0を写真のidとして登録 %>
        <%= form.hidden_field :user_id, value: current_user.id %><%# hidden_fieldは入力フィールドをユーザーに見えない状態で作成。ただし開発者ツールで確認できるので注視 %>
      <% else %>
        <%= form.hidden_field :user_id, value: 0 %>
      <% end %>
      <%= form.hidden_field :latitude, value: 0, id: 'latitude-field' %> <%# id:はhidden_filedのid %>
      <%= form.hidden_field :longitude, value: 0, id: 'longitude-field' %>
      <%= form.submit "投稿", id: "submitForm", class: "submit-btn" %>
    <% end %>
  </div>
</div>

<div id="popup-view-background" class="popup-view-background">
  <div id="popup-view-content" class="popup-view-content">
    <span id="close-view-popup" class="close-view-popup">&times;</span>
    <img id="popup-view-image" class="popup-view-image" src="" alt="Popup Image">
  </div>
</div>


<div id="map-container">

  <div id="map" style="height: 100vh; width: 100%;"></div>

  <div id="sidebar">
    <div class="current-post-wrapper">
      <div id="current-post-container">

      </div>
    </div>
  </div>

  <div id="RightSideMenuList">
    <div class="myProfile menuButton" id="myProfileSideBarOpenButton">
      <img src="<%= asset_path('search.png') %>"class="menuButtonIcon search">
    </div>
    <div class="user-search menuButton" id="userSearchSideBarOpenButton">
      <img src="<%= asset_path('search.png') %>"class="menuButtonIcon search">
    </div>
    <div class="notion menuButton" id="userSearchSideBarOpenButton">
      <img src="<%= asset_path('search.png') %>"class="menuButtonIcon search">
    </div>
  </div>

  <div class="myProfileSideBar  sidebar" id="myProfileSideBar" >
  <button class="closeSideBar" id="closeMyProfileSidebar">×</button>
    <div class="profile-wapper">
        <div class="profile-top-wrapper">
          <div class="profileIcon-wrapper">
            <div class="profileIcon sweezy-custom-cursor-hover"><img src="<%= asset_path('userIcon.png') %>" class="profileIcon-img sweezy-custom-cursor-hover"></div>
            <div class="profileGreenButton"><img src="<%= asset_path('postGreenButton.png') %>"  class="profileGreeniImage sweezy-custom-cursor-hover"></div>
          </div>
          <div class="profile-edit"><%= link_to "Edit profile", root_path, class:"btn btn--orange" %></div>
          <div class="profile-name"><%= @user.name %></div>
        </div>
      <div class="follow-wrapper">
        <div class="follow-count">following<br>99</div><div class="follow-count">folowed<br>99</div>
      </div>
      <div class="self-intro">自己紹介のスペースです。</div>
    </div>

    <div class="ex-post-container">
      <img src="#",alt="過去ポスト1" class="ex-post">
      <img src="#",alt="過去ポスト2" class="ex-post">
      <img src="#",alt="過去ポスト3" class="ex-post">
      <img src="#",alt="過去ポスト4" class="ex-post">
      <img src="#",alt="過去ポスト5" class="ex-post">
      <img src="#",alt="過去ポスト6" class="ex-post">
      <img src="#",alt="過去ポスト7" class="ex-post">
      <img src="#",alt="過去ポスト8" class="ex-post">
      <img src="#",alt="過去ポスト9" class="ex-post">
    </div>

  </div>




  <div class="search-sidebar sidebar" id="userSearchSideBar">
    <button class="closeSideBar" id="closeUserSearchSidebar">×</button>


    <%= search_form_for @search, url: users_search_path, html: { data: { turbo_frame: "user-search-turbo"}} do |f| %> <%# turbo_frameを利用 %>

      <%= f.search_field :name_cont , placeholder: "ユーザー名"%>
    
      <button type="submit">
        <img src="<%= asset_path('search.png') %>" alt="検索">
      </button>
    <% end %>
    
    <div id="user-search-border"></div>
    
    <turbo-frame id="user-search-turbo">
    </turbo-frame>

  </div>


<% if false %>
  <div id="menuPanel">
    <div class="profile-wrapper">
        <div class="profile-img-wrapper">
          <div><img src="/app/assets/images/userIcon.png" alt="顔" class="profile-img"></div>
          <div class="profile-edit"><%= link_to "Edit profile", root_path, class:"btn btn--orange" %></div>
          <div class="profile-name"><%= @user.name %></div>
        </div>
      <div class="follow-wrapper">
        <div class="follow-count">following<br>99</div><div class="follow-count">folowed<br>99</div>
      </div>
      <div class="self-intro">自己紹介のスペースです。</div>
    </div>

    <div class="ex-post-container">
      <img src="#",alt="過去ポスト1" class="ex-post">
      <img src="#",alt="過去ポスト2" class="ex-post">
      <img src="#",alt="過去ポスト3" class="ex-post">
      <img src="#",alt="過去ポスト4" class="ex-post">
      <img src="#",alt="過去ポスト5" class="ex-post">
      <img src="#",alt="過去ポスト6" class="ex-post">
      <img src="#",alt="過去ポスト7" class="ex-post">
      <img src="#",alt="過去ポスト8" class="ex-post">
      <img src="#",alt="過去ポスト9" class="ex-post">
    </div>
    <button type="button" id="closeButton" class="close-btn">&#10005;</button>
  </div>
<% end %>

  <div id="noticePanel" class="menu-hidden">
    <div class="noticeHeader">お知らせ</div>
    <div class="notice-container">
      <div class="notice">通知1</div>
      <div class="notice">通知2</div>
      <div class="notice">通知3</div>
      <div class="notice">通知4</div>
      <div class="notice">通知5</div>
      <div class="notice">通知6</div>
      <div class="notice">通知7</div>
      <div class="notice">通知8</div>
    </div>
    <button type="button" id="notice-closeButton" class="close-btn">&#10005;</button>
  </div>

  <div id="searchPanel" class="menu-hidden">
    <div class="searchHeader">検索</div>
    <button type="button" id="search-closeButton" class="close-btn">&#10005;</button>
  </div>

  <div id="logo"><img src="<%= asset_path('logo1.png') %>" id="logo-img"></div>

</div>
